<link
		rel="import"
		href="/static/bower_components/polymer/polymer.html" />
<link
		rel="import"
		href="/static/bower_components/firebase-element/firebase-collection.html" />

<dom-module id="otree-chat">

	<template>

		<style>
			.msglist {
				height: 150px;
			}
		</style>

		<firebase-collection
      location="[[fbRef_]]"
      data="{{msgs}}"
      order-by-child="timestamp">
    </firebase-collection>

		<div class="panel panel-default">
			<div class="panel-heading">
		    <h3 class="panel-title">Chat</h3>
		  </div>
			<div class="panel-body">
				<div class="well msglist">
			    <template is="dom-repeat" items="[[msgs]]" as="msg">
			      <p>[[msg.sender]]: [[msg.content]]</p>
			    </template>	
				</div>
				<form>
					<div class="input-group">
						<input
								type="text"
								class="form-control"
								value="{{msg_::input}}"></input>
						<span class="input-group-btn">
					    <button
					        class="btn btn-default"
					        on-tap="send_">
					      Send
					    </button>
					  </span>
					</div>
				</form>
			</div>
		</div>

	</template>

	<script>
		Polymer({
			is: 'otree-chat',
			properties: {
				session: String,
				subsession: String,
				round: String,
				group: String,
				sender: String,
				msg_: String,
				fbRef_: {
					type: String,
					computed: 'computeFbRef_(session, subsession, round, group)'
				} 
			},
			computeFbRef_: function(session, subsession, round, group) {
				return (
					'https://otree.firebaseio.com/' +
					'/component/otree-chat/' +
					'/session/' + session +
					'/subsession/' + subsession +
					'/round/' + round +
					'/group/' + group +
					'/msgs');
			},
			send_: function(e) {
				e.preventDefault();
				if (typeof this.msgs === 'undefined') {
					this.set('msgs', []);
				}
				this.push('msgs', {
					content: this.msg_,
					sender: this.sender,
					timestamp: Date.now()
				});
				this.set('msg_', '');
			}
		});
	</script>

</dom-module>